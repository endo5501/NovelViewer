## Context

NovelViewerは Web小説ビューアとして新規開発を開始するFlutterアプリケーション。現在リポジトリにはFlutterプロジェクトが存在せず、開発環境の構築からスタートする。

既存の関連ツールとして以下が存在する:
- **DownloadNovel** (Python): Web小説サイトからテキストをダウンロードし、番号付きテキストファイルとしてローカル保存
- **GenGlossary** (Python): テキストファイル群から用語集を生成するツール

これらのツールが出力するファイル形式（番号付きテキストファイル、ディレクトリ単位の管理）との互換性を前提とする。

当面はデスクトップ（macOS）向けに開発するが、将来のiPad/Android対応を見据えた設計とする。

## Goals / Non-Goals

**Goals:**
- Flutterプロジェクトの初期構築と開発環境の確立
- 3カラムレイアウトの基本UIシェルの実装
- ローカルディレクトリからのテキストファイル一覧表示
- テキストファイルの選択・表示（横書き）
- テスト駆動開発（TDD）に適したプロジェクト構成
- 将来のモバイル対応を妨げないアーキテクチャ

**Non-Goals:**
- 縦書き表示対応（後続変更で対応）
- ルビ表示などのHTMLタグ解釈（後続変更で対応）
- ブックマーク機能
- LLM連携・用語検索・要約機能
- ダウンロード機能（既存DownloadNovelツールを外部利用）
- 設定画面の中身の実装（骨格のみ）
- ダークモード対応

## Decisions

### 1. Flutterプロジェクトの配置

**決定**: リポジトリルートにFlutterプロジェクトを配置する（サブディレクトリではなく直接）

**理由**: リポジトリ自体がNovelViewer専用であり、サブディレクトリに分ける必要がない。`memo/`や`openspec/`はFlutterプロジェクトの外に置かれるが、`.gitignore`で適切に管理する。

**代替案**: `app/`サブディレクトリに配置する案 → 不要な階層が増えるため却下。

### 2. 状態管理: Riverpod

**決定**: 状態管理に`flutter_riverpod`を採用する

**理由**:
- コンパイル時の安全性が高い（Provider型の不一致をコンパイル時に検出）
- テスタビリティが高く、TDDとの相性が良い（ProviderContainerによるテスト分離）
- 将来的な機能追加（LLM連携、ブックマーク等）で複雑な状態管理が必要になった際にスケールしやすい

**代替案**:
- `provider` → Riverpodの前身。型安全性とテスタビリティでRiverpodが上回る
- `bloc` → ボイラープレートが多く、初期段階のシンプルなアプリには過剰

### 3. アーキテクチャ: Feature-firstのレイヤード構成

**決定**: 以下のディレクトリ構成を採用する

```
lib/
  app.dart                    # MaterialApp定義
  main.dart                   # エントリポイント
  features/
    file_browser/             # ファイル一覧機能
      data/                   # データ層（ファイルシステムアクセス）
      presentation/           # UI層（Widget）
      providers/              # Riverpod providers
    text_viewer/              # テキスト表示機能
      data/
      presentation/
      providers/
    settings/                 # 設定画面（骨格のみ）
      presentation/
  shared/
    widgets/                  # 共通ウィジェット
    models/                   # 共通モデル
```

**理由**: 機能ごとにコードをまとめることで、後続の機能追加（ブックマーク、LLM連携等）を独立したfeatureとして追加しやすい。各featureが`data`/`presentation`/`providers`のレイヤーを持つことで責務が明確になる。

**代替案**: レイヤーfirst構成（`data/`, `domain/`, `presentation/`をトップレベルに配置）→ 機能数が増えると横断的にファイルを探す必要が生じるため却下。

### 4. ファイルシステムアクセス

**決定**: `file_picker`パッケージでルートディレクトリを選択し、`dart:io`の`Directory`/`File`でファイル一覧・読み込みを行う

**理由**: デスクトップアプリケーションでは`dart:io`で直接ファイルシステムにアクセスでき、最もシンプルなアプローチ。`file_picker`はディレクトリ選択のUIを提供する。

**代替案**: `path_provider` + カスタムパス管理 → ディレクトリ選択のUIが別途必要になるため、`file_picker`で統一。

### 5. UIレイアウト構成

**決定**: `Row` + `Expanded`による3カラムレイアウト。左右カラムは`SizedBox`で固定幅、中央は`Expanded`で残りの領域を使用。カラム間は`VerticalDivider`で区切り、ドラッグによるリサイズは初期段階では対応しない。

**理由**: 最もシンプルなFlutterの標準ウィジェットで実現でき、初期段階には十分。リサイズ対応は将来必要に応じて追加。

### 6. テスト戦略

**決定**: TDDで以下のテストを整備する
- **Unit Test**: Providerのロジック、ファイルシステムアクセスのデータ層
- **Widget Test**: 各カラムのウィジェット表示

**理由**: CLAUDE.mdにTDDが開発方針として明記されており、初期段階からテスト基盤を確立する。

## Risks / Trade-offs

- **[`dart:io`依存]** → デスクトップ前提で`dart:io`を直接使用するため、Web対応は不可。将来のモバイル対応時は`dart:io`が利用可能なため問題なし。
- **[固定幅カラム]** → 初期段階ではカラム幅のリサイズに対応しない。ユーザビリティの問題が出た場合、後続で`split_view`系パッケージの導入を検討する。→ 初期リリースでは固定幅で十分と判断。
- **[大量ファイル時のパフォーマンス]** → 数百〜数千のテキストファイルを持つディレクトリでのパフォーマンスは未検証。→ `ListView.builder`による遅延レンダリングで対応し、必要に応じてページネーションを追加。
- **[エンコーディング]** → テキストファイルのエンコーディングがUTF-8以外の場合の対応は初期スコープ外。→ UTF-8を前提とし、問題が発生した場合に対応を検討。
