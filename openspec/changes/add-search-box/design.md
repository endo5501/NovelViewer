## Context

現在のNovelViewerの検索機能は、テキストを選択した状態でCtrl+F/Cmd+Fを押すと、選択テキストが`searchQueryProvider`にセットされ、右カラムの`SearchResultsPanel`に検索結果が表示される仕組みである。テキスト未選択時にCtrl+Fを押しても何も起きない。

検索に関連するUIは右カラム（`SearchSummaryPanel`）内の`SearchResultsPanel`に集約されており、ここに検索ボックスを追加するのが自然な設計である。

## Goals / Non-Goals

**Goals:**

- テキスト未選択時のCtrl+F/Cmd+Fで検索ボックスを表示し、任意の文字列を入力して検索可能にする
- 検索ボックスは右カラムの`SearchResultsPanel`上部に配置し、検索UIを一箇所に集約する
- Escキーで検索ボックスをクリアし閉じる
- テキスト選択済みの場合は従来通りの即時検索動作を維持する

**Non-Goals:**

- 検索ボックスをフローティングオーバーレイとして中央パネル上に表示する設計（将来的な検討事項）
- 正規表現検索や大文字小文字の区別切り替え
- 前へ/次へのナビゲーションボタン

## Decisions

### 1. 検索ボックスの配置場所：SearchResultsPanel上部

**選択**: `SearchResultsPanel`の上部にTextFieldを追加する

**理由**: 検索結果と検索入力を同じパネルに集約することで、ユーザーが検索操作を一箇所で完結できる。右カラムは既に検索結果の表示に使われており、検索入力もここに置くのが最も一貫性がある。

**代替案**:
- 中央パネル上部にフローティング検索バー → ブラウザ風UIだが、検索結果パネルと離れて操作が分散する
- AppBarに検索フィールド追加 → 常に表示される面積を消費する

### 2. Ctrl+F時の動作分岐

**選択**: `_SearchIntent`のハンドラ内で`selectedTextProvider`を確認し分岐する

- テキスト選択あり → 従来通り`searchQueryProvider.setQuery(selectedText)`で即時検索
- テキスト選択なし → 検索ボックスの表示状態を制御する`searchBoxVisibleProvider`をtrueにセットし、右カラムが非表示なら自動的に表示する

**理由**: 既存のショートカットハンドラの拡張で済み、新しいIntentやShortcutを追加する必要がない。

### 3. 検索ボックスの状態管理

**選択**: 以下の新しいProviderを追加する

- `searchBoxVisibleProvider` (`StateProvider<bool>`) — 検索ボックスの表示/非表示状態
- `searchBoxFocusNodeProvider` (`Provider<FocusNode>`) — 検索ボックスへのフォーカス制御

**理由**: 検索ボックスの表示状態をProviderで管理することで、`home_screen.dart`のショートカットハンドラから表示制御でき、`SearchResultsPanel`がその状態を監視して描画を切り替えられる。

### 4. 検索の実行タイミング

**選択**: テキスト入力後にEnterキーを押した時に検索を実行する（`onSubmitted`）

**理由**: リアルタイム検索はファイル数が多い場合にパフォーマンス問題を引き起こす可能性がある。Enterキーでの明示的な実行が安全で、ユーザーの意図も明確になる。

### 5. Escキーの動作

**選択**: 検索ボックスにフォーカスがある状態でEscキーを押すと、検索クエリをクリアし、検索ボックスを非表示にし、テキストビューアにフォーカスを戻す

**理由**: 一般的なアプリケーションの検索UI動作と一致しており、ユーザーが直感的に操作できる。

## Risks / Trade-offs

- **右カラム非表示時の操作性** → Ctrl+F時に右カラムが非表示なら自動表示することで対応。ユーザーが意図的に右カラムを隠していた場合に意図せず表示されるリスクがあるが、検索を要求した時点で検索UIの表示は妥当。
- **フォーカス管理の複雑さ** → 検索ボックスのフォーカス制御とテキストビューアのフォーカスが競合する可能性がある。FocusNodeを明示的に管理し、Escでフォーカスを戻すことで対応。
