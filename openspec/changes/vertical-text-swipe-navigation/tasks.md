## 1. テスト作成（TDD: テストファースト）

- [x] 1.1 スワイプ判定ロジックのユニットテストを作成（水平距離・速度・主軸条件の判定）
- [x] 1.2 左スワイプで次ページ、右スワイプで前ページに遷移するウィジェットテストを作成
- [x] 1.3 最初のページで右スワイプ、最後のページで左スワイプが無効であるテストを作成
- [x] 1.4 遅いドラッグ・短い移動・縦方向ドラッグがスワイプとして認識されないテストを作成
- [x] 1.5 スワイプ検出時にテキスト選択がクリアされるテストを作成
- [x] 1.6 矢印キーナビゲーションがスワイプ実装後も正常に動作するテストを作成
- [x] 1.7 テストを実行し、全テストが失敗することを確認

## 2. スワイプ判定ロジックの実装

- [x] 2.1 スワイプ閾値の定数を定義（最小距離50px、最小速度200px/s）
- [x] 2.2 スワイプ判定関数を実装（水平距離・速度・主軸の3条件チェック）
- [x] 2.3 テストを実行し、スワイプ判定ロジックのユニットテストがパスすることを確認

## 3. VerticalTextViewerへのスワイプジェスチャ統合

- [x] 3.1 既存の`Listener`を拡張し、`onPointerDown`でポインタID・開始位置・開始時刻を記録
- [x] 3.2 `onPointerUp`で同一ポインタIDの場合にスワイプ判定を実行し、条件を満たせばページ切り替えを実行
- [x] 3.3 スワイプ検出時に`onSelectionChanged?.call(null)`でテキスト選択をクリア
- [x] 3.4 テストを実行し、全テストがパスすることを確認

## 4. デスクトップ環境対応（velocity=0問題の修正）

- [x] 4.1 `detectSwipeFromDrag`関数を追加（`DragEndDetails.velocity`を直接使用）
- [x] 4.2 デュアル閾値方式を実装（velocity有り→50px、velocity無し→80px）
- [x] 4.3 スワイプ検出を`VerticalTextPage._onPanEnd`に移動（`Listener`方式から変更）
- [x] 4.4 `onPanDown`で真のポインタ開始位置を取得
- [x] 4.5 `VerticalTextViewer`の`Listener`を簡素化（フォーカス要求のみ）
- [x] 4.6 デスクトップ向けテスト追加（ドラッグ後に停止してからリリース）
- [x] 4.7 テストを実行し、全テストがパスすることを確認

## 5. ジェスチャーモード早期判定（スワイプ/テキスト選択の安定化）

- [x] 5.1 `_GestureMode`列挙型（`undecided`/`selecting`/`swiping`）と`_kGestureDecisionThreshold`定数(10px)を追加
- [x] 5.2 水平ドラッグ中にテキスト選択ハイライトが表示されないことのテストを作成
- [x] 5.3 縦方向ドラッグでテキスト選択が正常に動作することのテストを作成
- [x] 5.4 閾値未満の短いドラッグが問題を起こさないことのテストを作成
- [x] 5.5 `_onPanStart`を修正: `_anchorIndex`のみ記録し`setState()`を呼ばない（遅延選択）
- [x] 5.6 `_onPanUpdate`を修正: モード判定ロジックを導入（`undecided`→方向で分岐、`swiping`→位置追跡のみ、`selecting`→選択範囲更新）
- [x] 5.7 `_onPanEnd`を修正: `swiping`/`undecided`→スワイプ判定、`selecting`→選択通知
- [x] 5.8 テストを実行し、全テストがパスすることを確認

## 6. 最終確認

- [x] 6.1 code-simplifierエージェントを使用してコードをよりシンプルにできないか確認
- [x] 6.2 codexスキルを使用して現在開発中のコードレビューを実施
- [x] 6.3 `fvm flutter analyze`でリントを実行
- [x] 6.4 `fvm flutter test`でテストを実行
